---
title: 'Azure AD Connect: Migrera grupper från en skog till en annan'
description: I den här artikeln beskrivs de steg som krävs för att migrera grupper från en skog till en annan för Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: how-to
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 5ef693a48dc52854e4e1fd8359ef24f65ce236f7
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/29/2021
ms.locfileid: "85358590"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrera grupper från en skog till en annan för Azure AD Connect

I den här artikeln beskrivs hur du migrerar grupper från en skog till en annan så att de migrerade grupp objekten matchar befintliga objekt i molnet.

## <a name="prerequisites"></a>Förutsättningar

- Azure AD Connect version 1.5.18.0 eller senare
- Käll ankarets attribut har angetts till `mS-DS-ConsistencyGuid`

## <a name="migrate-groups"></a>Migrera grupper

Från och med version 1.5.18.0 stöder Azure AD Connect användningen av `mS-DS-ConsistencyGuid` attributet för grupper. Om du väljer `mS-DS-ConsistencyGuid` som käll-Anchor-attribut och värdet fylls i Active Directory, använder Azure AD Connect värdet `mS-DS-ConsistencyGuid` som `immutableId` . Annars går den tillbaka till att använda `objectGUID` . Observera dock att Azure AD Connect inte skriver värdet tillbaka till `mS-DS-ConsistencyGuid` attributet i Active Directory.

När ett grupp objekt flyttas från en skog (t. ex. F1) till en annan skog (säg F2) måste du kopiera antingen `mS-DS-ConsistencyGuid` värdet (om det finns) eller `objectGUID` värdet från objektet i skogen F1 till `mS-DS-ConsistencyGuid` attributet för objektet i F2.

Använd följande skript som vägledning för att lära dig hur du migrerar en enskild grupp från en skog till en annan. Du kan också använda dessa skript som en guide för migreringen av flera grupper. Skripten använder skogs namnet F1 för käll skogen och F2 för mål skogen.

Först hämtar vi och- `objectGUID` `mS-DS-ConsistencyGuid` grupp-objektet i skogen F1. De här attributen exporteras till en CSV-fil.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to the Export-Group script.
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Därefter använder vi den genererade CSV-filen för att stämpla `mS-DS-ConsistencyGuid` attributet på målobjektet i skogen F2:


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by the Import-Group script.
It copies either the objectGUID or the mS-DS-ConsistencyGuid value from the CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Nästa steg
Läs mer om hur [du integrerar dina lokala identiteter med Azure Active Directory](whatis-hybrid-identity.md).
