---
title: Azure Service Bus meddelanden, nyttolaster och serialisering | Microsoft Docs
description: Den här artikeln innehåller en översikt Azure Service Bus av meddelanden, nyttolaster, meddelanderoutning och serialisering.
ms.topic: article
ms.date: 04/14/2021
ms.openlocfilehash: 2ed65054f61aee4b9fb6157fc7a36e469c7a672c
ms.sourcegitcommit: db925ea0af071d2c81b7f0ae89464214f8167505
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 04/15/2021
ms.locfileid: "107515302"
---
# <a name="messages-payloads-and-serialization"></a>Meddelanden, nyttolaster och serialisering

Microsoft Azure Service Bus hanterar meddelanden. Meddelanden har en nyttolast och metadata. Metadata är i form av egenskaper för nyckel/värde-par och beskriver nyttolasten och ger hanteringsanvisningar för Service Bus och program. Ibland räcker det med enbart metadata för att överföra den information som avsändaren vill förmedla till mottagarna, och nyttolasten förblir tom.

Objektmodellen för de officiella Service Bus-klienterna för .NET och Java återspeglar den abstrakta Service Bus-meddelandestrukturen, som mappas till och från de trådprotokoll som Service Bus stöder.
 
Ett Service Bus-meddelande består av ett binärt nyttolastavsnitt som Service Bus aldrig hanterar i någon form på tjänstsidan och två uppsättningar egenskaper. *Koordinatoregenskaperna* är fördefinierade av systemet. Dessa fördefinierade egenskaper styr antingen funktioner på meddelandenivå i den antingen antingen koordinatortjänsten eller mappar till vanliga och standardiserade metadataobjekt. *Användaregenskaperna* är en samling nyckel/värde-par som kan definieras och anges av programmet.
 
De fördefinierade koordinatoregenskaperna visas i följande tabell. Namnen används med alla officiella klient-API:er och även i [BrokerProperties](https://docs.microsoft.com/rest/api/servicebus/introduction) JSON-objektet för HTTP-protokollmappningen.
 
Motsvarande namn som används på AMQP-protokollnivå visas inom parentes. Namnen nedan använder Pascal-hölje, men observera att JavaScript- och Python-klienterna använder kamel- respektive kamelnotering.

| Egenskapens namn                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ContentType` (innehållstyp)           | Alternativt beskrivs nyttolasten för meddelandet med en beskrivning som följer formatet RFC2045, avsnitt 5; till exempel `application/json` .                                                                                                                                                                                                                                                                                             |
| `CorrelationId` (korrelations-id)       | Gör det möjligt för ett program att ange en kontext för meddelandet i samband med korrelation. till exempel, vilket **återspeglar MessageId** för ett meddelande som håller på att tas bort.                                                                                                                                                                                                                                                                  |
| `DeadLetterSource`                      | Anges endast i meddelanden som har blivit inkommande och senare automatiskt skickade från kön för dead-letter till en annan entitet. Anger den entitet där meddelandet var dead-lettered. Den här egenskapen är skrivskyddade.                                                                                                                                                                                                                                  |
| `DeliveryCount`                         | <p>Antal leveranser som har försökts för det här meddelandet. Antalet ökas när ett meddelandelås upphör att gälla, eller om meddelandet uttryckligen övergavs av mottagaren. Den här egenskapen är skrivskyddade.</p> <p>Antalet leveranser ökas inte när den underliggande AMQP-anslutningen stängs.</p>                                                                                                                                                                                                                                                 |
| `EnqueuedSequenceNumber`                | För meddelanden som har tilldelats automatiskt återspeglar den här egenskapen det sekvensnummer som först hade tilldelats till meddelandet vid den ursprungliga sändningspunkten. Den här egenskapen är skrivskyddade.                                                                                                                                                                                                                                                                |
| `EnqueuedTimeUtc`                       | UTC-instansen där meddelandet har accepterats och lagrats i entiteten. Det här värdet kan användas som en auktoritativ och neutral ankomsttidsindikator när mottagaren inte vill lita på avsändarens klocka. Den här egenskapen är skrivskyddade.                                                                                                                                                                                                   |
| `ExpiresAtUtc` (absolut förfallotid) | UTC-instansen där meddelandet har markerats för borttagning och inte längre är tillgängligt för hämtning från entiteten på grund av dess upphörande. Förfallotid styrs av **egenskapen TimeToLive** och den här egenskapen beräknas från EnqueuedTimeUtc+TimeToLive. Den här egenskapen är skrivskyddade.                                                                                                                                                                           |
| `Label` eller `Subject` (ämne)                       | Den här egenskapen gör att programmet kan ange syftet med meddelandet till mottagaren på ett standardiserat sätt, ungefär som en ämnesrad för e-post.                                                                                                                                                                                                                                                                                  |
| `LockedUntilUtc`                        | För meddelanden som hämtas under ett lås (peek-lock receive mode, not pre-settled) återspeglar den här egenskapen UTC-instansen tills meddelandet hålls låst i kön/prenumerationen. När låset upphör att gälla [ökas DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) och meddelandet är återigen tillgängligt för hämtning. Den här egenskapen är skrivskyddade.                                                                                                                         |
| `LockToken`                             | Låstoken är en referens till det lås som den autjämnare håller i *peek-lock-mottagningsläget.* Token kan användas för att fästa låset permanent via API:et [för](message-deferral.md) upplåsning och med det ta meddelandet bort från det vanliga leveranstillståndsflödet. Den här egenskapen är skrivskyddade.                                                                                                                                                               |
| `MessageId` (meddelande-id)                | Meddelandeidentifieraren är ett programdefinierat värde som unikt identifierar meddelandet och dess nyttolast. Identifieraren är en friformssträng som kan återspegla ett GUID eller en identifierare som härletts från programkontexten. Om funktionen för [dubblettidentifiering](duplicate-detection.md) är aktiverad identifierar och tar den bort andra och ytterligare inskickade meddelanden med samma **MessageId.**                                                                |
| `PartitionKey`                          | Om du anger det här värdet för [partitionerade](service-bus-partitioning.md)entiteter kan du tilldela relaterade meddelanden till samma interna partition, så att överföringssekvensordningen registreras korrekt. Partitionen väljs av en hash-funktion över det här värdet och kan inte väljas direkt. För sessionsmedvetna entiteter **åsidosätter egenskapen SessionId** det här värdet.                                                                                                       |
| `ReplyTo` (svara på)                    | Det här valfria och programdefinierade värdet är ett standard sätt att uttrycka en svarssökväg till mottagaren av meddelandet. När en avsändare förväntar sig ett svar anger den värdet till den absoluta eller relativa sökvägen för kön eller ämnet som svaret ska skickas till.                                                                                                                                           |
| `ReplyToSessionId` (svar till grupp-id)  | Det här värdet utökar **ReplyTo-informationen** och anger vilket **SessionId** som ska anges för svaret när det skickas till svarsentiteten.                                                                                                                                                                                                                                                                            |
| `ScheduledEnqueueTimeUtc`               | För meddelanden som endast görs tillgängliga för hämtning efter en fördröjning definierar den här egenskapen utc-instansen där meddelandet ska finnas i en logisk plats, sekvenseras och därför göras tillgängligt för hämtning.                                                                                                                                                                                                                 |
| `SequenceNumber`                        | Sekvensnumret är ett unikt 64-bitars heltal som tilldelats till ett meddelande eftersom det accepteras och lagras av den a broker och fungerar som dess sanna identifierare. För partitionerade entiteter återspeglar de översta 16 bitarna partitionsidentifieraren. Sekvensnummer ökar monotont och är gaplösa. De går över till 0 när 48–64-bitarsintervallet är slut. Den här egenskapen är skrivskyddade.                                                                |
| `SessionId` (grupp-id)                  | För sessionsmedvetna entiteter anger det här programdefinierade värdet meddelandets sessionstillhörighet. Meddelanden med samma sessionsidentifierare omfattas av sammanfattningslåsning och möjliggör exakt bearbetning i ordning och demultiplexing. För entiteter som inte är sessionsmedvetna ignoreras det här värdet.                                                                                                                                     |
                                                                                                                                          |
| `TimeToLive`                            | Det här värdet är den relativa varaktigheten efter vilken meddelandet upphör att gälla, med början från det ögonblick då meddelandet har accepterats och lagrats av den a broker som avbildas i **EnqueueTimeUtc**. Om inget värde anges uttryckligen är det antas värdet **DefaultTimeToLive** för respektive kö eller ämne. Ett **TimeToLive-värde på** meddelandenivå får inte vara längre än entitetens **DefaultTimeToLive-inställning.** Om den är längre justeras den tyst. |
| `To` (till)                               | Den här egenskapen är reserverad för framtida användning i routningsscenarier och ignoreras för närvarande av den a broker själv. Program kan använda det här värdet i regeldrivna scenarier för automatisk länkning för att ange det avsedda logiska målet för meddelandet.                                                                                                                                                                                   |
| `ViaPartitionKey`                       | Om ett meddelande skickas via en överföringskö i omfånget för en transaktion, väljer det här värdet partitionen för överföringskö.                                                                                                                                                                                                                                                                                                                 |

Med den abstrakta meddelandemodellen kan ett meddelande publiceras i en kö via HTTPS och hämtas via AMQP. I båda fallen ser meddelandet normalt ut i kontexten för respektive protokoll. Koordinatoregenskaperna översätts efter behov och användaregenskaperna mappas till den lämpligaste platsen i respektive protokollmeddelandemodell. I HTTP mappas användaregenskaper direkt till och från HTTP-huvuden. i AMQP mappar de till och från **programegenskaperna.**

## <a name="message-routing-and-correlation"></a>Meddelanderoutning och korrelation

En delmängd av de a broker-egenskaper som beskrevs tidigare, särskilt , , , , och , används för att hjälpa program `To` att dirigera meddelanden till specifika `ReplyTo` `ReplyToSessionId` `MessageId` `CorrelationId` `SessionId` mål. Överväg några mönster för att illustrera den här funktionen:

- **Enkel begäran/svar:** En utgivare skickar ett meddelande till en kö och förväntar sig ett svar från meddelandekonsumenten. För att få svaret äger utgivaren en kö som den förväntar sig att svar ska levereras till. Adressen för kön uttrycks i egenskapen **ReplyTo för** det utgående meddelandet. När konsumenten svarar kopierar den **MessageId** för det hanterade meddelandet till egenskapen **CorrelationId** för svarsmeddelandet och levererar meddelandet till målet som anges av egenskapen **ReplyTo.** Ett meddelande kan ge flera svar, beroende på programkontext.
- **Multicast-begäran/-svar:** Som en variant av det tidigare mönstret skickar en utgivare meddelandet till ett ämne och flera prenumeranter blir berättigade att använda meddelandet. Var och en av prenumeranterna kan svara på det sätt som beskrevs tidigare. Det här mönstret används i identifierings- eller samtalsscenarier och svarande identifierar sig vanligtvis med en användaregenskap eller inuti nyttolasten. Om **ReplyTo** pekar på ett ämne kan en sådan uppsättning identifieringssvar distribueras till en målgrupp.
- **Multiplexering:** Den här sessionsfunktionen möjliggör multiplexering av strömmar av relaterade meddelanden via en enda kö eller prenumeration så att varje session (eller grupp) av relaterade meddelanden, som identifieras genom matchande **SessionId-värden,** dirigeras till en specifik mottagare medan mottagaren håller sessionen under lås. Läs mer om information om sessioner [här.](message-sessions.md)
- **Multiplexerad begäran/svar:** Den här sessionsfunktionen möjliggör multiplexerade svar, vilket gör att flera utgivare kan dela en svarskö. Genom att **ange ReplyToSessionId** kan utgivaren instruera konsumenterna att kopiera värdet till **egenskapen SessionId** för svarsmeddelandet. Publiceringskön eller ämnet behöver inte vara sessionsmedvetet. När meddelandet skickas kan utgivaren sedan specifikt vänta på att en session med det angivna **Sessions-ID:t** materialiseras i kön genom att villkorligt acceptera en sessionsmottagare. 

Routning i en Service Bus namnrymd kan realiseras med hjälp av regler för automatisk länkning och ämnesprenumeration. Routning mellan namnområden kan realiseras [med hjälp av Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Som anges i föregående lista är egenskapen **Till** reserverad för framtida användning och kan så småningom tolkas av den a broker med en särskilt aktiverad funktion. Program som vill implementera routning bör göra det baserat på användaregenskaper och inte förlita sig på **egenskapen Till.** Men om du gör det nu kommer det inte att orsaka kompatibilitetsproblem.

## <a name="payload-serialization"></a>Nyttolastserialisering

När nyttolasten överförs eller lagras inuti Service Bus är nyttolasten alltid ett täckande binärt block. Egenskapen gör att program kan beskriva nyttolasten, där det föreslagna formatet för egenskapsvärdena är en BESKRIVNING av `ContentType` MIME-innehållstyp enligt IETF RFC2045, till exempel `application/json;charset=utf-8` .

Till skillnad från Java- eller .NET Standard-varianter stöder .NET Framework-versionen av Service Bus-API:et att skapa **BrokeredMessage-instanser** genom att skicka godtyckliga .NET-objekt till konstruktorn. 

När du använder det äldre SBMP-protokollet serialiseras dessa objekt sedan med den binära standard serialiseraren eller med en serialiserare som tillhandahålls externt. När du använder AMQP-protokollet serialiseras objektet till ett AMQP-objekt. Mottagaren kan hämta dessa objekt med [metoden GetBody \<T> ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) och ange den förväntade typen. Med AMQP serialiseras objekten till en AMQP-graf med - och -objekt, och alla `ArrayList` `IDictionary<string,object>` AMQP-klienter kan avkoda dem. 

Även om denna dolda serialisering är praktisk, bör program ta explicit kontroll över objektserialisering och omvandla sina objektdiagram till dataströmmar innan de inkluderas i ett meddelande, och göra det omvända på mottagarsidan. Detta ger samverkande resultat. AMQP har en kraftfull modell för binär kodning, men den är kopplad till ekosystemet för AMQP-meddelanden och HTTP-klienter kommer att ha problem med att avkoda sådana nyttolaster. 

.NET Standard- och Java API-varianterna accepterar bara bytematriser, vilket innebär att programmet måste hantera objektserialiseringskontroll. 

## <a name="next-steps"></a>Nästa steg

Mer information om Service Bus finns i följande avsnitt:

* [Service Bus-köer, ämnen och prenumerationer](service-bus-queues-topics-subscriptions.md)
* [Komma igång med Service Bus-köer](service-bus-dotnet-get-started-with-queues.md)
* [Använd Service Bus ämnen och prenumerationer](service-bus-dotnet-how-to-use-topics-subscriptions.md)
