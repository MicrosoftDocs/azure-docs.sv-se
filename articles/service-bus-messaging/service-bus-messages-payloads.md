---
title: Azure Service Bus meddelanden, nytto laster och serialisering | Microsoft Docs
description: Den här artikeln innehåller en översikt över Azure Service Bus meddelanden, nytto laster, meddelanderoutning och serialisering.
ms.topic: article
ms.date: 01/29/2021
ms.openlocfilehash: e1baca1cd3dedee5917670a00b62c68752b5e4b8
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/29/2021
ms.locfileid: "101095107"
---
# <a name="messages-payloads-and-serialization"></a>Meddelanden, nyttolaster och serialisering

Microsoft Azure Service Bus hanterar meddelanden. Meddelanden har en nytto last och metadata. Metadata är i form av nyckel värdes par egenskaper, och beskriver nytto lasten och ger hanterings instruktioner för Service Bus och program. Ibland räcker det att endast metadata för att överföra den information som sändaren vill kommunicera med mottagare och nytto lasten förblir tom.

Objekt modellen för de officiella Service Bus-klienterna för .NET och Java återspeglar den abstrakta Service Bus meddelande strukturen, som är mappad till och från överförings protokollen Service Bus stöder.
 
Ett Service Bus meddelande består av ett binärt nytto Last avsnitt som Service Bus aldrig hanterar i något formulär på tjänst sidan och två uppsättning egenskaper. *Egenskaperna för Service Broker* är fördefinierade i systemet. Dessa fördefinierade egenskaper styr antingen funktioner i meddelande nivå inuti Broker eller mappar till vanliga och standardiserade metadata-objekt. *Användar egenskaperna* är en samling nyckel/värde-par som kan definieras och anges av programmet.
 
De fördefinierade egenskaperna för Service Broker visas i följande tabell. Namnen används med alla officiella klient-API: er och även i [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON-objektet för HTTP-protokoll mappningen.
 
Motsvarande namn som används på AMQP-protokoll nivån visas inom parentes. 

| Egenskapens namn                         | Beskrivning                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [`ContentType`](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (innehålls typ)           | Beskriver alternativt meddelandets nytto Last, med en beskrivning som följer formatet på RFC2045, avsnitt 5; till exempel `application/json` .                                                                                                                                                                                                                                                                                             |
|  [`CorrelationId`](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (korrelations-ID)       | Gör det möjligt för ett program att ange en kontext för meddelandet i samband med korrelation. till exempel återspeglar **messageid** för ett meddelande som besvaras.                                                                                                                                                                                                                                                                  |
| [`DeadLetterSource`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Anges endast i meddelanden som har avsänts och senare vidarebefordrats från kön för obeställbara meddelanden till en annan entitet. Anger den entitet där meddelandet har avvisats. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                  |
| [`DeliveryCount`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | <p>Antal leveranser som har gjorts för det här meddelandet. Antalet ökar när ett meddelande lås upphör att gälla, eller så överges meddelandet explicit av mottagaren. Den här egenskapen är skrivskyddad.</p> <p>Leverans antalet ökar inte när den underliggande AMQP-anslutningen stängs.</p>                                                                                                                                                                                                                                                 |
| [`EnqueuedSequenceNumber`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | För meddelanden som har vidarebefordrats automatiskt visar denna egenskap det ordnings nummer som först hade tilldelats meddelandet vid den ursprungliga överföringen. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                |
| [`EnqueuedTimeUtc`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | UTC-tid då meddelandet har accepterats och lagrats i entiteten. Det här värdet kan användas som en indikator för auktoritativ och neutral mottagnings tid när mottagaren inte vill lita på avsändarens klocka. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                   |
|  [`ExpiresAtUtc`](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolut-förfallo datum-tid) | UTC-tid då meddelandet markeras för borttagning och inte längre är tillgängligt för hämtning från entiteten på grund av dess förfallo datum. Expireen styrs av egenskapen **TimeToLive** och den här egenskapen beräknas från EnqueuedTimeUtc + TimeToLive. Den här egenskapen är skrivskyddad.                                                                                                                                                                           |
| [`ForcePersistence`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | För köer eller ämnen som har [`EnableExpress`](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) flaggan angiven, kan den här egenskapen anges för att ange att meddelandet måste vara kvar på disken innan det bekräftas. Det här beteendet är standard beteendet för alla icke-Express-entiteter.                                                                                                                                                                                                         |
| [`Label`](/dotnet/api/microsoft.azure.servicebus.message.label) motiv                       | Den här egenskapen gör att programmet kan ange syftet med meddelandet till mottagaren på ett standardiserat sätt, ungefär som en e-postämnesrad.                                                                                                                                                                                                                                                                                  |
| [`LockedUntilUtc`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | För meddelanden som hämtats under ett lås (Peek-lock Receive-läge, inte förbetalt), visar den här egenskapen UTC-tiden för att skicka meddelandet till låst i kön/prenumerationen. När låset upphör att gälla ökas [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) och meddelandet är återigen tillgängligt för hämtning. Den här egenskapen är skrivskyddad.                                                                                                                         |
| [`LockToken`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Lås-token är en referens till det lås som innehas av Broker i *gransknings låsets* mottagnings läge. Token kan användas för att fästa låset permanent genom uppskjutnings-API: et och, [med det,](message-deferral.md) ta meddelandet från det vanliga leverans tillstånds flödet. Den här egenskapen är skrivskyddad.                                                                                                                                                               |
| [`MessageId`](/dotnet/api/microsoft.azure.servicebus.message.messageid) (meddelande-ID)                | Meddelande identifieraren är ett Programdefinierat värde som unikt identifierar meddelandet och dess nytto Last. Identifieraren är en sträng med fri form och kan återspegla ett GUID eller en identifierare som härletts från program kontexten. Om funktionen för [dubblettidentifiering](duplicate-detection.md) är aktive rad identifieras och tas andra inskickade meddelanden med samma **messageid**.                                                                |
| [`PartitionKey`](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | För [partitionerade entiteter](service-bus-partitioning.md)kan du ange det här värdet för att tilldela relaterade meddelanden till samma interna partition, så att ordningen för överförings ordningen registreras korrekt. Partitionen väljs av en hash-funktion över detta värde och kan inte väljas direkt. För sessionsbaserade entiteter åsidosätter egenskapen **SessionID** detta värde.                                                                                                       |
| [`ReplyTo`](/dotnet/api/microsoft.azure.servicebus.message.replyto) (svar till)                    | Det här valfria och programdefinierade värdet är ett standard sätt att uttrycka en svars väg till mottagaren av meddelandet. När en avsändare förväntar sig ett svar anges värdet till den absoluta eller relativa sökvägen till kön eller ämnet som förväntar sig att svaret skickas till.                                                                                                                                           |
| [`ReplyToSessionId`](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (svar till grupp-ID)  | Det här värdet ökar **ReplyTo** -informationen och anger vilket **SessionID** som ska anges för svaret när det skickas till svars enheten.                                                                                                                                                                                                                                                                            |
| [`ScheduledEnqueueTimeUtc`](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | För meddelanden som bara görs tillgängliga för hämtning efter en fördröjning definierar den här egenskapen UTC-tid som meddelandet logiskt kommer att placeras i kö, sekvenseras och därför görs tillgängligt för hämtning.                                                                                                                                                                                                                 |
| [`SequenceNumber`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Sekvensnumret är ett unikt 64-bitars heltal som tilldelas ett meddelande, eftersom det godkänns och lagras av Broker och fungerar som den faktiska identifieraren. För partitionerade entiteter återspeglar de översta 16 bitarna partitions-ID. Sekvensnummer monotont ökning och är gapless. De går över till 0 när 48-64-bitars intervallet är förbrukat. Den här egenskapen är skrivskyddad.                                                                |
| [`SessionId`](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (grupp-ID)                  | För sessionsbaserade entiteter anger det här programdefinierade värdet sessions-anknytningen för meddelandet. Meddelanden med samma sessions-ID är föremål för sammanfattnings låsning och möjliggör exakt bearbetning och demultiplexering av order. För entiteter som inte är sessions medveten ignoreras värdet.                                                                                                                                     |
| [`Size`](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Visar den lagrade storleken på meddelandet i Broker-loggen som ett antal byte, eftersom det räknas mot lagrings kvoten. Den här egenskapen är skrivskyddad.                                                                                                                                                                                                                                                                                                       |
| [`State`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Anger status för meddelandet i loggen. Den här egenskapen är endast relevant vid meddelande bläddring ("Peek") för att avgöra om ett meddelande är "aktivt" och tillgängligt för hämtning eftersom det når överst i kön, om det är uppskjutet eller väntar på att schemaläggas. Den här egenskapen är skrivskyddad.                                                                                                                                           |
| [`TimeToLive`](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Det här värdet är den relativa varaktigheten efter vilken meddelandet upphör att gälla, med början från det omedelbara meddelandet har accepterats och lagrats av koordinatorn, som det fångas in i **EnqueueTimeUtc**. När det inte anges explicit är det förmodade värdet **DefaultTimeToLive** för respektive kö eller ämne. Ett **TimeToLive** -värde på meddelande nivå får inte vara längre än entitetens **DefaultTimeToLive** -inställning. Om det är längre justeras det tyst. |
| [Till](/dotnet/api/microsoft.azure.servicebus.message.to) (till)                               | Den här egenskapen är reserverad för framtida användning i routningsgränssnitt och ignoreras för närvarande av Service Broker. Programmen kan använda det här värdet i scenarier med regel drivna scenarier för autospolning som anger det avsedda logiska målet för meddelandet.                                                                                                                                                                                   |
| [`ViaPartitionKey`](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Om ett meddelande skickas via en överförings kö i omfånget för en transaktion väljer det här värdet den överförda Queue-partitionen.                                                                                                                                                                                                                                                                                                                 |

Med den abstrakta meddelande modellen kan ett meddelande skickas till en kö via HTTPS och kan hämtas via AMQP. I båda fallen ser meddelandet normalt ut i kontexten för respektive protokoll. Egenskaperna för Service Broker översätts vid behov och användar egenskaperna mappas till den lämpligaste platsen i respektive protokoll meddelande modell. I HTTP mappas användar egenskaper direkt till och från HTTP-huvuden; i AMQP mappas de till och från mappningen för **program egenskaper** .

## <a name="message-routing-and-correlation"></a>Meddelanderoutning och korrelation

En delmängd av Service Broker-egenskaperna som beskrivs ovan, specifikt [för](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [messageid](/dotnet/api/microsoft.azure.servicebus.message.messageid), [correlationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid)och [SessionID](/dotnet/api/microsoft.azure.servicebus.message.sessionid), används för att hjälpa program dirigera meddelanden till specifika destinationer. Tänk på några mönster för att illustrera den här funktionen:

- **Enkel begäran/svar**: en utgivare skickar ett meddelande till en kö och förväntar sig ett svar från meddelande konsumenten. För att kunna ta emot svaret äger utgivaren en kö där det förväntar sig att svar skickas. Adressen till kön uttrycks i egenskapen **ReplyTo** för det utgående meddelandet. När konsumenten svarar kopieras **messageid** för det hanterade meddelandet till egenskapen **correlationId** i svarsmeddelandet och levererar meddelandet till den destination som anges av egenskapen **ReplyTo** . Ett meddelande kan ge flera svar, beroende på program kontexten.
- **Multicast-begäran/svar**: som en variant av det tidigare mönstret skickar en utgivare meddelandet till ett ämne och flera prenumeranter blir berättigade att använda meddelandet. Var och en av prenumeranterna kan svara på det sätt som beskrivits ovan. Det här mönstret används i identifierings-eller återställnings scenarier och svaranden identifieras vanligt vis med en användar egenskap eller i nytto lasten. Om **ReplyTo** pekar på ett ämne kan en uppsättning identifierings svar distribueras till en mål grupp.
- **Multiplexering**: den här sessionen aktiverar multiplexering av strömmar med relaterade meddelanden via en enskild kö eller prenumeration, så att varje session (eller grupp) av relaterade meddelanden, som identifieras genom matchande **SessionID** -värden, dirigeras till en viss mottagare medan mottagaren håller sessionen under lås. Läs mer om informationen om sessioner [här](message-sessions.md).
- **Multiplex-begäran/svar**: den här sessionen aktiverar Multiplexed-svar, vilket gör att flera utgivare kan dela en svarskö. Genom att ställa in **ReplyToSessionId** kan utgivare instruera konsumenten att kopiera värdet till egenskapen **SessionID** i svarsmeddelandet. Publicerings kön eller avsnittet behöver inte vara sessions medveten. När meddelandet skickas, kan utgivaren särskilt vänta på att en session med angivet **SessionID** ska materialiseras i kön genom att villkorligt acceptera en session mottagare. 

Routning i ett Service Bus namn område kan realiseras med hjälp av autoforward-länkning och prenumerations regler för ämnen. Routning över namn områden kan realiseras [med hjälp av Azure-LogicApps](https://azure.microsoft.com/services/logic-apps/). Som anges i föregående lista är **till** -egenskapen reserverad för framtida användning och kan slutligen tolkas av koordinatorn med en särskilt aktive rad funktion. Program som vill implementera routning bör göra detta baserat på användar egenskaper och inte luta **till egenskapen till** . men det kan nu orsaka kompatibilitetsproblem.

## <a name="payload-serialization"></a>Serialisering av nytto Last

Vid överföring eller lagring inuti Service Bus är nytto lasten alltid ett täckande, binärt block. Egenskapen [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) gör det möjligt för program att beskriva nytto lasten, med det föreslagna formatet för egenskaps värden som en MIME Content-Type-Beskrivning enligt IETF-RFC2045; till exempel `application/json;charset=utf-8` .

Till skillnad från Java-eller .NET-standardvarianterna stöder .NET Framework versionen av Service Bus-API: et stöd för att skapa **BrokeredMessage** -instanser genom att skicka godtyckliga .net-objekt till konstruktorn. 

När du använder det äldre SBMP-protokollet serialiseras dessa objekt sedan med den förvalda binära serialiseraren, eller med en serialiserare som är externt angiven. När du använder AMQP-protokollet serialiseras objektet till ett AMQP-objekt. Mottagaren kan hämta dessa objekt med metoden [GetBody \<T> ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) genom att ange den förväntade typen. Med AMQP serialiseras objekten till en AMQP-graf med `ArrayList` och `IDictionary<string,object>` objekt, och eventuella AMQP-klienter kan avkoda dem. 

Även om det här dolda serialiserings trollet är bekvämt, bör programmen ta explicit kontroll över objekt serialiseringen och omvandla objekt till strömmar innan de inkluderas i ett meddelande, och du kan göra det baklänges på mottagar sidan. Detta ger driftskompatibla resultat. Även om AMQP har en kraftfull binär kodnings modell, är den kopplad till AMQP-eko systemet och HTTP-klienter har problem med att avkoda sådana nytto laster. 

API-variantarna .NET standard och Java accepterar bara byte-matriser, vilket innebär att programmet måste hantera objekt serialiserings kontroll. 

## <a name="next-steps"></a>Nästa steg

Mer information om Service Bus meddelanden finns i följande avsnitt:

* [Service Bus-köer, ämnen och prenumerationer](service-bus-queues-topics-subscriptions.md)
* [Komma igång med Service Bus-köer](service-bus-dotnet-get-started-with-queues.md)
* [Använd Service Bus ämnen och prenumerationer](service-bus-dotnet-how-to-use-topics-subscriptions.md)
