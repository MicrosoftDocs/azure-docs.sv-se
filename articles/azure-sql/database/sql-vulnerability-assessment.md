---
title: SQL sårbarhets bedömning
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Lär dig hur du konfigurerar SQL sårbarhet Assessment och tolkar utvärderings rapporterna på Azure SQL Database, Azure SQL-hanterad instans och Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 04/09/2021
tags: azure-synapse
ms.openlocfilehash: bff01bbb65228ff4fba6e0a71518bc0d778220d2
ms.sourcegitcommit: b4fbb7a6a0aa93656e8dd29979786069eca567dc
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 04/13/2021
ms.locfileid: "107307103"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL sårbarhets bedömning hjälper dig att identifiera databas sårbarheter
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

SQL sårbarhet Assessment är en tjänst som är enkel att konfigurera och som kan upptäcka, spåra och hjälpa dig att åtgärda potentiella databas sårbarheter. Du kan använda den för att proaktivt förbättra din databassäkerhet.

Sårbarhets bedömning ingår i [Azure Defender for SQL](azure-defender-for-sql.md) -erbjudandet, som är ett enhetligt paket för avancerade SQL-säkerhetsfunktioner. Sårbarhets bedömning kan nås och hanteras via den centrala Azure Defender för SQL-portalen.

> [!NOTE]
> Sårbarhets bedömning stöds för Azure SQL Database, Azure SQL-hanterad instans och Azure Synapse Analytics. Databaser i Azure SQL Database, Azure SQL-hanterad instans och Azure Synapse Analytics kallas kollektivt i resten av den här artikeln som databaser, och servern refererar till den [Server](logical-servers.md) som är värd för databaser för Azure SQL Database och Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>Vad är en utvärdering av SQL-sårbarhet?

SQL sårbarhet Assessment är en tjänst som ger insyn i ditt säkerhets tillstånd. Sårbarhets bedömning innehåller åtgärder som kan vidtas för att lösa säkerhets problem och förbättra databas säkerheten. Det kan hjälpa dig att övervaka en dynamisk databas miljö där ändringar är svåra att spåra och förbättra din SQL-position.

Sårbarhets bedömning är en skannings tjänst som är inbyggd i Azure SQL Database. Tjänsten använder en kunskaps bas för regler som åtgärdar säkerhets sårbarheter. Den visar avvikelser från bästa praxis, till exempel felkonfigurationer, överdriven behörighet och oskyddade känsliga data.

Reglerna baseras på Microsofts bästa praxis och fokuserar på de säkerhets problem som utgör de största riskerna för din databas och dess värdefulla data. De behandlar problem på databas nivå och säkerhets problem på server nivå, t. ex. inställningar för Server brand väggen och behörigheter på server nivå.

Resultaten av genomsökningen innehåller åtgärds bara steg för att lösa varje problem och tillhandahålla anpassade reparations skript där det är tillämpligt. Du kan anpassa en utvärderings rapport för din miljö genom att ange en acceptabel bas linje för:

- Behörighets konfiguration
- Funktions konfiguration
- Databas inställningar

## <a name="configure-vulnerability-assessment"></a>Konfigurera sårbarhets bedömning

Utför följande steg för att konfigurera sårbarhets bedömning:

1. I [Azure Portal](https://portal.azure.com)öppnar du den angivna resursen i Azure SQL Database, SQL-hanterad instans databas eller Azure-Synapse.

1. Under **säkerhets** rubriken väljer du **Security Center**.

1. Välj **Konfigurera** på länken för att öppna fönstret Azure Defender för SQL-inställningar för antingen hela servern eller den hanterade instansen.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Öppnar Defender för SQL-konfigurationen":::

    > [!NOTE]
    > SQL sårbarhet Assessment kräver att **Azure Defender för SQL** -plan kan köra genomsökningar. Mer information om hur du aktiverar Azure Defender för SQL finns i [Azure Defender för SQL](azure-defender-for-sql.md).

1. På sidan **Server inställningar** definierar du inställningarna för Azure Defender för SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Konfigurera genomsökningar av SQL sårbarhets bedömning":::

    1. Konfigurera ett lagrings konto där genomsöknings resultaten för alla databaser på servern eller den hanterade instansen kommer att lagras. Information om lagrings konton finns i [om Azure Storage-konton](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Mer information om hur du lagrar sårbarhets bedömnings genomsökningar bakom brand väggar och virtuella nätverk finns i [Sök Resultat för sökning efter sårbarhets bedömning i ett lagrings konto som är tillgängligt bakom brand väggar och virtuella nätverk](sql-database-vulnerability-assessment-storage.md).

    1. Om du vill konfigurera sårbarhets bedömningar för automatisk körning av veckovis genomsökningar för att identifiera felaktigare säkerhet, ställer du in **periodiska återkommande sökningar** till **på**. Resultaten skickas till de e-postadresser som du anger i **Skicka skannings rapporter till**. Du kan också skicka e-postaviseringar till administratörer och prenumerations ägare genom att aktivera **även skicka e-postmeddelanden till administratörer och prenumerations ägare**.

1. Genomsökningar av SQL sårbarhets bedömning kan också köras på begäran:

    1. På resursens **Security Center** sida väljer du **Visa ytterligare resultat i sårbarhets bedömning** för att få åtkomst till genomsöknings resultaten från tidigare genomsökningar.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Öppna alternativen Sök Resultat och manuella genomsökningar":::

    1. Om du vill köra en genomsökning på begäran för att genomsöka databasen efter sårbarheter väljer du **Genomsök** i verktygsfältet:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Välj Genomsök för att köra en genomsökning på begäran om en sårbarhets bedömning av SQL-resursen":::


  > [!NOTE]
  > Genomsökningen är lätt och säker. Det tar några sekunder att köra och är helt skrivskyddat. Det gör inga ändringar i databasen.

## <a name="remediate-vulnerabilities"></a>Åtgärda sårbarheter

När en sårbarhets sökning slutförs visas rapporten i Azure Portal. Rapporten visar:

- En översikt över ditt säkerhets tillstånd
- Antalet problem som hittades och
- En sammanfattning efter allvarlighets graden för riskerna
- En lista över resultaten för ytterligare undersökningar

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Söknings rapport om sökrapport från SQL sårbarhet Assessment-skanner":::

Åtgärda de identifierade säkerhets problemen:

1. Granska resultaten och ta reda på vilka av rapportens resultat som är sanna med säkerhets problem i din miljö.

1. Välj varje misslyckat resultat för att förstå dess inverkan och varför säkerhets kontrollen misslyckades.

    > [!TIP]
    > Sidan med resultat information innehåller åtgärds bara reparations information som förklarar hur du löser problemet.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Undersöka resultaten från en sårbarhets ökning":::

1. När du granskar resultatet av utvärderingen kan du markera speciella resultat som en acceptabel *bas linje* i din miljö. En bas linje är i grunden en anpassning av hur resultaten rapporteras. I efterföljande genomsökningar betraktas resultat som matchar bas linjen som pass. När du har fastställt ditt grundläggande säkerhets tillstånd kan du endast rapportera om avvikelser från bas linjen i utlösnings utvärderingen. På så sätt kan du fokusera på de relevanta problemen.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Godkänna en sökning som en bas linje för framtida genomsökningar":::

1. Om du ändrar bas linjerna använder du knappen **Skanna** för att köra en genomsökning på begäran och visa den anpassade rapporten. Eventuella avgörande som du har lagt till i bas linjen visas nu **i en** indikation om att de har godkänts på grund av ändringar i bas linjen.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Slutförda utvärderingar som indikerar att de har passerat per anpassad bas linje":::

Dina genomsökningar för sårbarhets bedömning kan nu användas för att säkerställa att din databas upprätthåller en hög säkerhets nivå och att organisationens principer är uppfyllda. 

## <a name="advanced-capabilities"></a>Avancerade funktioner

### <a name="export-an-assessment-report"></a>Exportera en utvärderingsrapport

Välj **Exportera skannings resultat** för att skapa en nedladdnings bar Excel-rapport över ditt genomsöknings resultat. Den här rapporten innehåller en sammanfattnings flik som visar en sammanfattning av utvärderingen. Rapporten innehåller alla misslyckade kontroller. Den innehåller också en **resultat** -flik som innehåller den fullständiga uppsättningen resultat från sökningen. Resultatet inkluderar alla kontroller som kördes och resultat informationen för varje.

### <a name="view-scan-history"></a>Visa genomsökningshistorik

Välj **genomsöknings historik** i fönstret sårbarhets bedömning om du vill visa en historik över alla genomsökningar som tidigare har körts på den här databasen. Välj en viss sökning i listan om du vill visa detaljerade resultat för den genomsökningen.

### <a name="disable-specific-findings-from-azure-security-center-preview"></a>Inaktivera vissa resultat från Azure Security Center (för hands version)

Om du har ett organisations behov av att ignorera en sökning i, i stället för att åtgärda det, kan du inaktivera det. Inaktiverade resultat påverkar inte din säkra poäng eller genererar oönskad brus.

När en sökning matchar de kriterier som du har definierat i inaktiverade regler visas de inte i listan över resultat. Vanliga scenarier är:

- Inaktivera undersöknings resultat med allvarlighets grad under medel
- Inaktivera resultat som inte kan korrigeras
- Inaktivera resultat från benchmarks som inte är av intresse för ett definierat omfång

> [!IMPORTANT]
> Om du vill inaktivera vissa resultat måste du ha behörighet att redigera en princip i Azure Policy. Läs mer i [Azure RBAC-behörigheter i Azure policy](../../governance/policy/overview.md#azure-rbac-permissions-in-azure-policy).

Så här skapar du en regel:

1. På sidan rekommendationer för **sårbarhets bedömning på dina SQL-servrar på datorer bör du åtgärda problemet genom att** välja **Inaktivera regel**.

1. Välj relevant omfattning.

1. Definiera dina kriterier. Du kan använda något av följande kriterier: 
    - Söker efter ID 
    - Allvarlighetsgrad 
    - Benchmark-värden 

    :::image type="content" source="../../security-center/media/defender-for-sql-on-machines-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="Skapa en Inaktivera regel för VA-konstateranden på SQL-servrar på datorer":::

1. Välj **tillämpa regel**. Det kan ta upp till dygnet innan ändringarna börjar gälla.

1. Visa, åsidosätta eller ta bort en regel: 

    1. Välj **Inaktivera regel**.

    1. Från listan omfång visas prenumerationer med aktiva regler som **tillämpad regel**.

        :::image type="content" source="../../security-center/media/remediate-vulnerability-findings-vm/modify-rule.png" alt-text="Ändra eller ta bort en befintlig regel":::

    1. Om du vill visa eller ta bort regeln väljer du ellips-menyn ("...").

## <a name="manage-vulnerability-assessments-programmatically"></a>Hantera sårbarhets bedömningar program mässigt

### <a name="using-azure-powershell"></a>Använda Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> PowerShell Azure Resource Manager-modulen stöds fortfarande, men all framtida utveckling gäller AZ. SQL-modulen. De här cmdletarna finns i [AzureRM. SQL](/powershell/module/AzureRM.Sql/). Argumenten för kommandona i AZ-modulen och i AzureRm-modulerna är i stort sett identiska.

Du kan använda Azure PowerShell-cmdletar för att hantera dina sårbarhets bedömningar program mässigt. De cmdlet: ar som stöds är:

| Cmdlet-namn som en länk | Description |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Rensar regelns bas linje för sårbarhets bedömning.<br/>Börja med att ange bas linjen innan du använder denna cmdlet för att ta bort den. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Rensar inställningarna för sårbarhets bedömning för en databas. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Rensar regelns bas linje för sårbarhets bedömning för en hanterad databas.<br/>Börja med att ange bas linjen innan du använder denna cmdlet för att ta bort den. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Rensar inställningarna för sårbarhets bedömning för en hanterad databas. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Rensar inställningarna för sårbarhets bedömning för en hanterad instans. |
| [Konvertera-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Konverterar genomsöknings resultat för sårbarhets bedömning av en databas till en Excel-fil. |
| [Konvertera-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Konverterar genomsöknings resultat för sårbarhets bedömning för en hanterad databas till en Excel-fil. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Hämtar regelns bas linje för sårbarhets bedömning av en databas för en specifik regel. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Hämtar regelns bas linje för sårbarhets bedömning för en hanterad databas för en specifik regel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Hämtar alla genomsöknings poster för sårbarhets bedömning som är associerade med en specifik databas. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Hämtar alla genomsöknings poster för sårbarhets bedömning som är kopplade till en specifik hanterad databas. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Returnerar inställningarna för sårbarhets bedömning för en databas. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Returnerar inställningarna för sårbarhets bedömning för en hanterad databas. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Anger regelns bas linje för sårbarhets bedömning. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Anger regel bas linje för sårbarhets bedömning för en hanterad databas. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Utlöser starten av en sökning efter sårbarhets bedömning på en databas. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Utlöser starten av en sökning efter sårbarhets bedömning på en hanterad databas. |
| [Uppdatera – AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Uppdaterar inställningarna för sårbarhets bedömning för en databas. |
| [Uppdatera – AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Uppdaterar inställningarna för sårbarhets bedömning för en hanterad databas. |
| [Uppdatera – AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Uppdaterar inställningarna för sårbarhets bedömning för en hanterad instans. |
| &nbsp; | &nbsp; |

Ett skript exempel finns i [PowerShell-support för Azure SQL sårbarhet Assessment](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Använda Resource Manager-mallar

Om du vill konfigurera bas linjer för sårbarhets bedömning med Azure Resource Manager mallar använder du `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` typen.

Kontrol lera att du har aktiverat `vulnerabilityAssessments` innan du lägger till bas linjer.

Här är ett exempel på hur du definierar VA2065 för bas linje regel för `master` databas och VA1143 till `user` databas som resurser i en Resource Manager-mall:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

För `master` databas och `user` databas definieras resurs namnen på olika sätt:

- Master-databas-"namn": "[concat (parameters (server_name),"/", parametrar (' database_name '), '/default/VA2065/<b>Master</b>')]",
- Användar databas – "namn": "[concat (parameters (server_name),"/", parametrar (' database_name '), '/default/VA2065/<b>default</b>')]",

Om du vill hantera booleska typer som TRUE/FALSE anger du bas linje resultatet med binär Indatatyp som "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Nästa steg  

- Läs mer om [Azure Defender för SQL](azure-defender-for-sql.md).
- Läs mer om [data identifiering och klassificering](data-discovery-and-classification-overview.md).
- Läs mer om att [lagra genomsöknings resultat för sårbarhets bedömning i ett lagrings konto som är tillgängligt bakom brand väggar och virtuella nätverk](sql-database-vulnerability-assessment-storage.md).
